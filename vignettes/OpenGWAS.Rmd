---
title: "Import GWAS summary statistics from Open GWAS"
author: "Alan Murphy, Brian Schilder, and Nathan Skene"
date: "`r Sys.Date()`"
output:
  BiocStyle::html_document:
    self_contained: yes
    toc: true
    toc_float: true
    toc_depth: 3
    code_folding: show
    df_print: paged
csl: nature.csl
vignette: >
    %\VignetteIndexEntry{OpenGWAS} 
    %\usepackage[utf8]{inputenc}
    %\VignetteEngine{knitr::rmarkdown}  
editor_options: 
  markdown: 
    wrap: 72
---

```{r style, echo=FALSE, results='asis', message=FALSE, dpi=400}
BiocStyle::markdown()
knitr::opts_chunk$set(tidy         = FALSE,
                      message      = FALSE)
```

```{r}
library(MungeSumstats)
```

MungeSumstats now offers high throughput query and import functionality to data 
from the MRC IEU [Open GWAS Project](https://gwas.mrcieu.ac.uk/).


# Find GWAS datasets 

```{r,eval=FALSE}
#### Search for datasets ####
metagwas <- MungeSumstats::find_sumstats(traits = c("parkinson","alzheimer"), 
                                         min_sample_size = 1000)
head(metagwas)
ids <- (dplyr::arrange(metagwas, nsnp))$id  
```

```{r,echo=FALSE}
#### Search for datasets ####
error_dwnld <-
            tryCatch(
              metagwas <- MungeSumstats::find_sumstats(traits = c("parkinson",
                                                                  "alzheimer"), 
                                         min_sample_size = 1000),
            error = function(e) e,
            warning = function(w) w
            )
if(exists("metagwas")&&is.data.frame(metagwas)){#if exists downloaded fine
  head(metagwas)
  ids <- (dplyr::arrange(metagwas, nsnp))$id  
}
```

# Import full results

You can supply `import_sumstats()` with a list of as many OpenGWAS IDs as you 
want, but we'll just give one to save time. 

```{r,eval=FALSE}
datasets <- MungeSumstats::import_sumstats(ids = "ieu-a-298",
                                           ref_genome = "GRCH37")
```

```{r,echo=FALSE}
error_dwnld <-
            tryCatch(
              datasets <- MungeSumstats::import_sumstats(ids = "ieu-a-298",
                                           ref_genome = "GRCH37"),
            error = function(e) e,
            warning = function(w) w
            )

if(!exists("datasets")){
  datasets <- list("ieu-a-298"=system.file("extdata","ieu-a-298.tsv.gz",
                                            package="MungeSumstats"))
}
```

## Summarise results 

By default, `import_sumstats` results a named list where the names are the Open 
GWAS dataset IDs and the items are the respective paths to the formatted summary
statistics.

```{r}
print(datasets)
```

You can easily turn this into a data.frame as well. 

```{r}
results_df <- data.frame(id=names(datasets), 
                         path=unlist(datasets))
print(results_df)
```




# Import full results (parallel)

*Optional*: Speed up with multi-threaded download via [axel](https://github.com/axel-download-accelerator/axel).  

```{r, eval=FALSE}
datasets <- MungeSumstats::import_sumstats(ids = ids, 
                                           vcf_download = TRUE, 
                                           download_method = "axel", 
                                           nThread = max(2,future::availableCores()-2))
```

# Further functionality

See the [Getting started vignette](https://neurogenomics.github.io/MungeSumstats/articles/MungeSumstats.html)
for more information on how to use MungeSumstats and its functionality.


# Session Info

<details>

```{r}
utils::sessionInfo()
```

</details>
