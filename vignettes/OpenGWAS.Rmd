---
title: "OpenGWAS"
author: "Brian M. Schilder"
date: "`r Sys.Date()`"
output:
  BiocStyle::html_document:
    self_contained: yes
    toc: true
    toc_float: true
    toc_depth: 3
    code_folding: show
    df_print: paged
csl: nature.csl
vignette: >
    %\VignetteIndexEntry{OpenGWAS} 
    %\usepackage[utf8]{inputenc}
    %\VignetteEngine{knitr::rmarkdown}  
editor_options: 
  markdown: 
    wrap: 72
---

```{r style, echo=FALSE, results='asis', message=FALSE}
BiocStyle::markdown()
knitr::opts_chunk$set(tidy         = FALSE,
                      message      = FALSE)
```

```{r}
library(MungeSumstats)
```

Query and import data from the MRC IEU [Open GWAS Project](https://gwas.mrcieu.ac.uk/).


# Find GWAS datasets

```{r}
#### Search for datasets ####
metagwas <- MungeSumstats::find_sumstats(traits = c("parkinson","alzheimer"), 
                                         min_sample_size = 5000)
head(metagwas)
ids <- (dplyr::arrange(metagwas, nsnp))$id[1:2]    
```

# Import full results

```{r}
datasets <- MungeSumstats::import_sumstats(ids = ids)
```

## Summarise results 

By default, `import_sumstats` results a named list where the names are the Open GWAS dataset IDs 
and the items are the respective paths to the formatted summary statistics.

```{r}
print(datasets)
```

You can easily turn this into a data.frame as well. 

```{r}
results_df <- data.frame(id=names(datasets), 
                         path=unlist(datasets))
print(results_df)
```




# Import full results (parallel)

*Optional*: Speed up with multi-threaded download via [axel](https://github.com/axel-download-accelerator/axel).  

```{r, eval=FALSE}
datasets <- MungeSumstats::import_sumstats(ids = ids, 
                                           vcf_download = TRUE, 
                                           download_method = "axel", 
                                           nThread = max(2,future::availableCores()-2))
```

# Session Info

<details>

```{r}
utils::sessionInfo()
```

</details>
